<!DOCTYPE html>
<html lang="en" data-theme="auto">
<head>
    <!-- Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Circle in the Skies - Celestial generative art with orbital mechanics and atmospheric simulation">
    <meta name="theme-color" content="#3b82f6">
    <meta name="color-scheme" content="light dark">

    <!-- Title -->
    <title>Circle in the Skies - Celestial Art Generator | Binary Ring</title>

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Circle in the Skies",
      "description": "Celestial generative art with realistic orbital mechanics and atmospheric effects",
      "url": "https://binaryring.art/tools/circle-skies",
      "applicationCategory": "CreativeApplication",
      "creator": {
        "@type": "Person",
        "name": "Mokrushin",
        "alternateName": "Izhevsky",
        "url": "https://binaryring.art/users/izhevsky"
      },
      "featureList": [
        "Orbital Mechanics Simulation",
        "Atmospheric Rendering",
        "Real-time Physics",
        "Celestial Body Generation",
        "Environmental Effects",
        "Time-lapse Animation"
      ],
      "screenshot": "https://binaryring.art/screenshots/circle-skies.jpg",
      "operatingSystem": "Web Browser",
      "browserRequirements": "WebGL 2.0 support required for full experience"
    }
    </script>

    <!-- Preconnects -->
    <link rel="preconnect" href="https://fonts.googleapis.com">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">

    <!-- Styles -->
    <link rel="stylesheet" href="/templates/huggingface-theme.css">
    <link rel="stylesheet" href="/templates/circle-skies.css">

    <!-- Configuration (inspired by circle-in-the-skies patterns) -->
    <script>
        window.circleSkiesConfig = {
            appId: 'circle-in-the-skies',
            version: '2.1.0',
            creator: 'Izhevsky',

            // Theme handling (from Izhevsky/circle pattern)
            theme: {
                autoDetect: true,
                cookieName: 'circle-skies-theme',
                systemTheme: window.matchMedia('(prefers-color-scheme: dark)').matches,
                transitions: {
                    enabled: true,
                    duration: 300
                }
            },

            // Celestial simulation parameters
            physics: {
                gravitationalConstant: 6.67430e-11,
                timeStep: 0.016, // 60 FPS
                maxBodies: 50,
                collisionDetection: true,
                orbitalDecay: false
            },

            // Visual rendering settings
            rendering: {
                antialiasing: true,
                atmosphereEnabled: true,
                trailsEnabled: true,
                glowEffects: true,
                starField: true,
                maxTrailLength: 1000,
                particleDensity: 'medium' // low, medium, high, ultra
            },

            // Environment presets
            environments: {
                solarSystem: {
                    scale: 1,
                    bodies: 9,
                    atmospheres: true
                },
                binarySystem: {
                    scale: 0.5,
                    bodies: 2,
                    orbitalResonance: true
                },
                nebula: {
                    scale: 2,
                    particleDensity: 'ultra',
                    colorPalette: 'cosmic'
                },
                asteroid: {
                    scale: 0.3,
                    bodies: 200,
                    collisions: true
                }
            },

            // Audio reactivity (inspired by space themes)
            audio: {
                enabled: false,
                microphone: false,
                frequencyBands: 128,
                sensitivity: 0.8,
                visualResponse: {
                    orbitalSpeed: true,
                    particleIntensity: true,
                    atmosphereGlow: true
                }
            },

            // Analytics (like HF implementation)
            analytics: {
                enabled: true,
                provider: 'plausible',
                domain: 'binaryring.art',
                respectDNT: true,
                events: {
                    simulation: 'Simulation Start',
                    preset: 'Preset Applied',
                    export: 'Animation Export',
                    share: 'Sky Share'
                }
            }
        };

        // Enhanced theme detection (inspired by circle-skies implementation)
        function initializeCircleSkiesTheme() {
            const themeRegex = new RegExp(`${window.circleSkiesConfig.theme.cookieName}=([^;]+)`);
            const themeMatch = document.cookie.match(themeRegex);
            const savedTheme = themeMatch ? themeMatch[1] : null;

            const systemDark = window.circleSkiesConfig.theme.systemTheme;
            const theme = savedTheme || (systemDark ? 'dark' : 'light');

            document.documentElement.setAttribute('data-theme', theme);
            document.documentElement.classList.toggle('dark', theme === 'dark');

            // Update theme-dependent canvas colors
            updateCanvasTheme(theme);
        }

        function updateCanvasTheme(theme) {
            const isDark = theme === 'dark';
            window.circleSkiesConfig.rendering.spaceColor = isDark ? '#000011' : '#001122';
            window.circleSkiesConfig.rendering.starColor = isDark ? '#ffffff' : '#ffffe0';
            window.circleSkiesConfig.rendering.nebulaAlpha = isDark ? 0.8 : 0.6;
        }

        // Initialize theme immediately
        initializeCircleSkiesTheme();

        // Listen for system theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            if (!document.cookie.includes(window.circleSkiesConfig.theme.cookieName)) {
                const newTheme = e.matches ? 'dark' : 'light';
                document.documentElement.setAttribute('data-theme', newTheme);
                document.documentElement.classList.toggle('dark', newTheme === 'dark');
                updateCanvasTheme(newTheme);
            }
        });
    </script>
</head>
<body class="circle-skies">
    <!-- Skip Link -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Header -->
    <header class="sky-header" role="banner">
        <div class="header-container">
            <!-- Branding -->
            <div class="header-brand">
                <a href="/" class="brand-link">
                    <svg class="brand-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M8 12h8M12 8v8"/>
                    </svg>
                    <span class="brand-text">Binary Ring</span>
                </a>
                <div class="app-info">
                    <h1 class="app-title">Circle in the Skies</h1>
                    <span class="app-creator">by Mokrushin</span>
                </div>
            </div>

            <!-- Simulation Controls -->
            <div class="simulation-controls">
                <button class="sim-btn play-pause" id="playPauseBtn" onclick="toggleSimulation()" title="Play/Pause">
                    <svg class="play-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <polygon points="5,3 19,12 5,21"/>
                    </svg>
                    <svg class="pause-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" style="display: none;">
                        <rect x="6" y="4" width="4" height="16"/>
                        <rect x="14" y="4" width="4" height="16"/>
                    </svg>
                </button>

                <button class="sim-btn" onclick="resetSimulation()" title="Reset">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <polyline points="23,4 23,10 17,10"/>
                        <polyline points="1,20 1,14 7,14"/>
                        <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
                    </svg>
                </button>

                <div class="time-controls">
                    <label for="timeScale" class="time-label">Time Scale:</label>
                    <input
                        type="range"
                        id="timeScale"
                        class="time-slider"
                        min="0.1"
                        max="5"
                        step="0.1"
                        value="1"
                        oninput="updateTimeScale(this.value)"
                    >
                    <span class="time-value" id="timeValue">1.0x</span>
                </div>
            </div>

            <!-- Header Actions -->
            <div class="header-actions">
                <!-- Screenshot -->
                <button class="action-btn" onclick="captureScreenshot()" title="Screenshot">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2v11z"/>
                        <circle cx="12" cy="13" r="4"/>
                    </svg>
                </button>

                <!-- Theme Toggle -->
                <button class="theme-toggle action-btn" onclick="toggleSkiesTheme()" title="Toggle Theme">
                    <span class="theme-icon theme-icon-light">‚òÄÔ∏è</span>
                    <span class="theme-icon theme-icon-dark">üåô</span>
                </button>

                <!-- Fullscreen -->
                <button class="action-btn" onclick="toggleFullscreen()" title="Fullscreen">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="sky-main" role="main">
        <div class="sky-layout">
            <!-- Environment Panel -->
            <aside class="environment-panel" role="complementary">
                <div class="panel-header">
                    <h2>Environment</h2>
                    <button class="panel-collapse" onclick="toggleEnvironmentPanel()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </button>
                </div>

                <div class="panel-content">
                    <!-- Environment Presets -->
                    <div class="preset-section">
                        <h3>Cosmic Presets</h3>
                        <div class="preset-grid">
                            <button class="preset-btn active" onclick="loadPreset('solarSystem')" data-preset="solar">
                                <div class="preset-icon">üåû</div>
                                <span>Solar System</span>
                            </button>
                            <button class="preset-btn" onclick="loadPreset('binarySystem')" data-preset="binary">
                                <div class="preset-icon">‚≠ê</div>
                                <span>Binary Stars</span>
                            </button>
                            <button class="preset-btn" onclick="loadPreset('nebula')" data-preset="nebula">
                                <div class="preset-icon">üåå</div>
                                <span>Nebula</span>
                            </button>
                            <button class="preset-btn" onclick="loadPreset('asteroid')" data-preset="asteroid">
                                <div class="preset-icon">‚òÑÔ∏è</div>
                                <span>Asteroid Field</span>
                            </button>
                        </div>
                    </div>

                    <!-- Physics Controls -->
                    <div class="controls-section">
                        <h3>Physics</h3>

                        <div class="control-group">
                            <label for="gravitySlider">Gravity: <span id="gravityValue">1.0</span></label>
                            <input
                                type="range"
                                id="gravitySlider"
                                min="0"
                                max="3"
                                step="0.1"
                                value="1"
                                oninput="updateGravity(this.value)"
                            >
                        </div>

                        <div class="control-group">
                            <label for="bodiesSlider">Celestial Bodies: <span id="bodiesValue">9</span></label>
                            <input
                                type="range"
                                id="bodiesSlider"
                                min="2"
                                max="50"
                                value="9"
                                oninput="updateBodies(this.value)"
                            >
                        </div>

                        <div class="control-group checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="collisions" onchange="toggleCollisions(this.checked)">
                                <span class="checkmark"></span>
                                Enable Collisions
                            </label>
                        </div>

                        <div class="control-group checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="orbitalTrails" checked onchange="toggleTrails(this.checked)">
                                <span class="checkmark"></span>
                                Orbital Trails
                            </label>
                        </div>
                    </div>

                    <!-- Visual Effects -->
                    <div class="controls-section">
                        <h3>Visual Effects</h3>

                        <div class="control-group">
                            <label for="atmosphereSlider">Atmosphere: <span id="atmosphereValue">0.8</span></label>
                            <input
                                type="range"
                                id="atmosphereSlider"
                                min="0"
                                max="1"
                                step="0.1"
                                value="0.8"
                                oninput="updateAtmosphere(this.value)"
                            >
                        </div>

                        <div class="control-group">
                            <label for="particleSlider">Particle Density: <span id="particleValue">50</span>%</label>
                            <input
                                type="range"
                                id="particleSlider"
                                min="0"
                                max="100"
                                value="50"
                                oninput="updateParticles(this.value)"
                            >
                        </div>

                        <div class="color-palette">
                            <label>Color Palette:</label>
                            <div class="palette-options">
                                <button class="palette-btn active" onclick="setPalette('cosmic')" data-palette="cosmic">
                                    <div class="palette-colors">
                                        <span style="background: #000033"></span>
                                        <span style="background: #6600cc"></span>
                                        <span style="background: #ff3366"></span>
                                    </div>
                                    Cosmic
                                </button>
                                <button class="palette-btn" onclick="setPalette('solar')" data-palette="solar">
                                    <div class="palette-colors">
                                        <span style="background: #ff6600"></span>
                                        <span style="background: #ffcc00"></span>
                                        <span style="background: #ffffff"></span>
                                    </div>
                                    Solar
                                </button>
                                <button class="palette-btn" onclick="setPalette('cool')" data-palette="cool">
                                    <div class="palette-colors">
                                        <span style="background: #003366"></span>
                                        <span style="background: #0066cc"></span>
                                        <span style="background: #00ccff"></span>
                                    </div>
                                    Cool
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Audio Reactivity -->
                    <div class="controls-section">
                        <h3>Audio Reactive</h3>

                        <div class="control-group checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="audioReactive" onchange="toggleAudio(this.checked)">
                                <span class="checkmark"></span>
                                Enable Audio Input
                            </label>
                        </div>

                        <div class="control-group" id="audioControls" style="display: none;">
                            <label for="sensitivitySlider">Sensitivity: <span id="sensitivityValue">0.8</span></label>
                            <input
                                type="range"
                                id="sensitivitySlider"
                                min="0.1"
                                max="2"
                                step="0.1"
                                value="0.8"
                                oninput="updateSensitivity(this.value)"
                            >
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Canvas Area -->
            <section class="canvas-section" role="main">
                <div class="canvas-container">
                    <!-- Performance Overlay -->
                    <div class="performance-overlay" id="performanceOverlay">
                        <div class="fps-counter">FPS: <span id="fpsCounter">60</span></div>
                        <div class="body-counter">Bodies: <span id="bodyCounter">9</span></div>
                        <div class="particle-counter">Particles: <span id="particleCounter">1024</span></div>
                    </div>

                    <!-- Main Canvas -->
                    <canvas id="skyCanvas" class="sky-canvas"></canvas>

                    <!-- Canvas Overlays -->
                    <div class="canvas-overlays">
                        <!-- Celestial Info Panel -->
                        <div class="celestial-info" id="celestialInfo" style="display: none;">
                            <h4 id="bodyName">Earth</h4>
                            <div class="info-stats">
                                <div class="stat">
                                    <span class="stat-label">Mass:</span>
                                    <span class="stat-value" id="bodyMass">5.97 √ó 10¬≤‚Å¥ kg</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-label">Velocity:</span>
                                    <span class="stat-value" id="bodyVelocity">29.8 km/s</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-label">Distance:</span>
                                    <span class="stat-value" id="bodyDistance">149.6M km</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Canvas Controls -->
                    <div class="canvas-controls">
                        <div class="view-controls">
                            <button class="view-btn" onclick="centerView()" title="Center View">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <circle cx="12" cy="12" r="10"/>
                                    <line x1="12" y1="8" x2="12" y2="16"/>
                                    <line x1="8" y1="12" x2="16" y2="12"/>
                                </svg>
                            </button>
                            <button class="view-btn" onclick="followBody()" title="Follow Object">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                                    <path d="M2 17l10 5 10-5"/>
                                    <path d="M2 12l10 5 10-5"/>
                                </svg>
                            </button>
                        </div>

                        <div class="zoom-controls">
                            <button class="zoom-btn" onclick="zoomIn()" title="Zoom In">+</button>
                            <span class="zoom-level" id="zoomDisplay">1.0x</span>
                            <button class="zoom-btn" onclick="zoomOut()" title="Zoom Out">‚àí</button>
                        </div>

                        <div class="export-controls">
                            <button class="export-btn" onclick="exportFrame()" title="Export Frame">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                    <circle cx="8.5" cy="8.5" r="1.5"/>
                                    <polyline points="21,15 16,10 5,21"/>
                                </svg>
                            </button>
                            <button class="export-btn" onclick="recordAnimation()" title="Record Animation">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <circle cx="12" cy="12" r="10"/>
                                    <polygon points="10,8 16,12 10,16"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Info Modal -->
    <div class="info-modal" id="infoModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>About Circle in the Skies</h2>
                <button class="modal-close" onclick="closeInfoModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p>Circle in the Skies is a real-time celestial mechanics simulation that generates beautiful orbital patterns through accurate physics modeling.</p>

                <h3>Features:</h3>
                <ul>
                    <li>Realistic gravitational physics</li>
                    <li>Atmospheric and particle effects</li>
                    <li>Multiple cosmic environments</li>
                    <li>Audio-reactive visualization</li>
                    <li>High-resolution export capabilities</li>
                </ul>

                <h3>Controls:</h3>
                <ul>
                    <li><strong>Mouse:</strong> Click and drag to orbit view</li>
                    <li><strong>Wheel:</strong> Zoom in/out</li>
                    <li><strong>Click Body:</strong> Show information panel</li>
                    <li><strong>Space:</strong> Play/pause simulation</li>
                    <li><strong>R:</strong> Reset to default view</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/templates/huggingface-config.js"></script>
    <script src="/templates/circle-skies-physics.js"></script>
    <script src="/templates/circle-skies-renderer.js"></script>
    <script src="/templates/circle-skies-main.js"></script>

    <!-- Initialize -->
    <script>
        // Theme toggle (inspired by circle-skies pattern)
        function toggleSkiesTheme() {
            const current = document.documentElement.getAttribute('data-theme');
            const newTheme = current === 'dark' ? 'light' : 'dark';

            document.documentElement.setAttribute('data-theme', newTheme);
            document.documentElement.classList.toggle('dark', newTheme === 'dark');

            // Update canvas theme
            updateCanvasTheme(newTheme);

            // Save preference
            document.cookie = `${window.circleSkiesConfig.theme.cookieName}=${newTheme}; path=/; max-age=31536000; SameSite=Lax`;

            // Track theme change
            if (window.BinaryRing) {
                BinaryRing.trackEvent('Theme Toggle', {
                    theme: newTheme,
                    app: 'circle-skies'
                });
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            initializeCircleSkies();

            // Track app usage
            if (window.BinaryRing) {
                BinaryRing.trackEvent('Celestial Simulation', {
                    app: 'circle-skies',
                    timestamp: Date.now()
                });
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            switch(e.code) {
                case 'Space':
                    e.preventDefault();
                    toggleSimulation();
                    break;
                case 'KeyR':
                    resetSimulation();
                    break;
                case 'KeyF':
                    toggleFullscreen();
                    break;
                case 'KeyI':
                    document.getElementById('infoModal').style.display = 'flex';
                    break;
            }
        });
    </script>
</body>
</html>