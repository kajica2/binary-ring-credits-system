<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keyword System Debug</title>
    <style>
        body {
            font-family: system-ui, sans-serif;
            background: #0a0a0a;
            color: white;
            margin: 0;
            padding: 20px;
        }
        .debug-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .debug-section {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .keyword-item {
            background: #2a2a2a;
            border: 1px solid #404040;
            border-radius: 6px;
            padding: 10px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .collect-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        .collect-btn:disabled {
            background: #555;
            cursor: not-allowed;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.error { background: #ef444420; border: 1px solid #ef4444; }
        .status.success { background: #10b98120; border: 1px solid #10b981; }
        .status.info { background: #3b82f620; border: 1px solid #3b82f6; }
        .demo-keywords {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin: 10px 0;
        }
        .keyword-tag {
            background: #4f46e5;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            cursor: pointer;
            border: none;
        }
        .keyword-tag:hover {
            background: #3730a3;
        }
        #collected-list {
            min-height: 50px;
            background: #2a2a2a;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>ðŸ”§ Keyword System Debug</h1>

        <div class="debug-section">
            <h2>1. Test Basic Functionality</h2>
            <div id="status-1" class="status info">Testing localStorage...</div>

            <h3>Quick Test Keywords:</h3>
            <div class="demo-keywords">
                <button class="keyword-tag" onclick="testCollect('audio-reactive')">audio-reactive</button>
                <button class="keyword-tag" onclick="testCollect('particle-systems')">particle-systems</button>
                <button class="keyword-tag" onclick="testCollect('generative-art')">generative-art</button>
                <button class="keyword-tag" onclick="testCollect('real-time')">real-time</button>
                <button class="keyword-tag" onclick="testCollect('mindfulness')">mindfulness</button>
            </div>

            <h3>Collected Keywords:</h3>
            <div id="collected-list">
                <em>None collected yet</em>
            </div>

            <button onclick="clearData()" style="background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 4px; margin-top: 10px;">
                Clear All Data
            </button>
        </div>

        <div class="debug-section">
            <h2>2. Test Mock Service</h2>
            <div id="status-2" class="status info">Initializing mock service...</div>

            <div class="keyword-item">
                <div>
                    <strong>ai-powered</strong>
                    <br><small>Artificial intelligence and machine learning concepts</small>
                </div>
                <button class="collect-btn" onclick="mockCollect('ai-powered', this)">Collect</button>
            </div>

            <div class="keyword-item">
                <div>
                    <strong>frequency-analysis</strong>
                    <br><small>Breaking down audio into component frequencies</small>
                </div>
                <button class="collect-btn" onclick="mockCollect('frequency-analysis', this)">Collect</button>
            </div>

            <div class="keyword-item">
                <div>
                    <strong>cosmic-visualization</strong>
                    <br><small>Visual representations of cosmic and celestial concepts</small>
                </div>
                <button class="collect-btn" onclick="mockCollect('cosmic-visualization', this)">Collect</button>
            </div>
        </div>

        <div class="debug-section">
            <h2>3. Test Recommendations</h2>
            <div id="status-3" class="status info">Ready to test recommendations...</div>
            <div id="recommendations-area">
                <button onclick="generateRecommendations()" style="background: #4f46e5; color: white; border: none; padding: 8px 16px; border-radius: 4px;">
                    Generate Recommendations
                </button>
            </div>
        </div>

        <div class="debug-section">
            <h2>4. Console Logs</h2>
            <div id="console-logs" style="background: #000; color: #0f0; font-family: monospace; padding: 15px; border-radius: 6px; max-height: 200px; overflow-y: auto;">
                <div>ðŸŸ¢ Debug console ready...</div>
            </div>
            <button onclick="clearConsole()" style="background: #333; color: white; border: none; padding: 8px 16px; border-radius: 4px; margin-top: 10px;">
                Clear Console
            </button>
        </div>
    </div>

    <script>
        // Debug logging
        function debugLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const console = document.getElementById('console-logs');
            const color = type === 'error' ? '#f00' : type === 'success' ? '#0f0' : '#ff0';
            console.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            console.scrollTop = console.scrollHeight;
        }

        // Test basic localStorage functionality
        function testCollect(keyword) {
            try {
                debugLog(`Attempting to collect keyword: ${keyword}`);

                let collected = JSON.parse(localStorage.getItem('debug_keywords') || '[]');
                if (!collected.includes(keyword)) {
                    collected.push(keyword);
                    localStorage.setItem('debug_keywords', JSON.stringify(collected));
                    debugLog(`âœ“ Successfully collected: ${keyword}`, 'success');
                } else {
                    debugLog(`âš  Keyword already collected: ${keyword}`, 'info');
                }

                updateCollectedList();
                document.getElementById('status-1').className = 'status success';
                document.getElementById('status-1').textContent = 'âœ“ localStorage working correctly';

            } catch (error) {
                debugLog(`âœ— Error collecting keyword: ${error.message}`, 'error');
                document.getElementById('status-1').className = 'status error';
                document.getElementById('status-1').textContent = 'âœ— localStorage error: ' + error.message;
            }
        }

        // Update the collected keywords display
        function updateCollectedList() {
            try {
                const collected = JSON.parse(localStorage.getItem('debug_keywords') || '[]');
                const listElement = document.getElementById('collected-list');

                if (collected.length === 0) {
                    listElement.innerHTML = '<em>None collected yet</em>';
                } else {
                    listElement.innerHTML = collected.map(keyword =>
                        `<span style="background: #4f46e5; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; margin: 2px; display: inline-block;">${keyword}</span>`
                    ).join('');
                }
                debugLog(`Updated display with ${collected.length} keywords`);
            } catch (error) {
                debugLog(`Error updating list: ${error.message}`, 'error');
            }
        }

        // Test mock service collection
        function mockCollect(keyword, button) {
            try {
                debugLog(`Mock collecting: ${keyword}`);

                // Simulate API call
                setTimeout(() => {
                    button.textContent = 'âœ“ Collected';
                    button.disabled = true;
                    button.style.background = '#4f46e5';

                    // Add to our test collection
                    testCollect(keyword);

                    debugLog(`âœ“ Mock service collected: ${keyword}`, 'success');
                    document.getElementById('status-2').className = 'status success';
                    document.getElementById('status-2').textContent = 'âœ“ Mock service working';
                }, 500);

            } catch (error) {
                debugLog(`âœ— Mock service error: ${error.message}`, 'error');
                document.getElementById('status-2').className = 'status error';
                document.getElementById('status-2').textContent = 'âœ— Mock service failed';
            }
        }

        // Generate mock recommendations
        function generateRecommendations() {
            try {
                debugLog('Generating recommendations...');

                const collected = JSON.parse(localStorage.getItem('debug_keywords') || '[]');
                const recArea = document.getElementById('recommendations-area');

                if (collected.length === 0) {
                    recArea.innerHTML = '<div style="color: #888; font-style: italic;">Collect some keywords first to get recommendations!</div>';
                    debugLog('No keywords collected - no recommendations generated', 'info');
                    return;
                }

                // Mock recommendation logic
                const recommendations = [];

                if (collected.includes('audio-reactive') || collected.includes('particle-systems')) {
                    recommendations.push({
                        title: 'Sonic Sculptor',
                        type: 'app',
                        match: 95,
                        reason: 'Audio-visual particle systems'
                    });
                }

                if (collected.includes('generative-art') || collected.includes('ai-powered')) {
                    recommendations.push({
                        title: 'AI Art Generator Template',
                        type: 'template',
                        match: 87,
                        reason: 'AI-powered generative art'
                    });
                }

                if (collected.includes('mindfulness') || collected.includes('cosmic-visualization')) {
                    recommendations.push({
                        title: 'Kosmos Journey',
                        type: 'app',
                        match: 82,
                        reason: 'Mindful cosmic exploration'
                    });
                }

                if (recommendations.length === 0) {
                    recommendations.push({
                        title: 'Binary Ring Templates',
                        type: 'template',
                        match: 65,
                        reason: 'General creative tools'
                    });
                }

                recArea.innerHTML = `
                    <h4 style="margin-top: 0;">Recommendations based on your ${collected.length} keywords:</h4>
                    ${recommendations.map(rec => `
                        <div style="background: #2a2a2a; border: 1px solid #404040; border-radius: 6px; padding: 15px; margin: 10px 0;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <strong>${rec.title}</strong>
                                <span style="background: #10b981; color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px;">${rec.match}% match</span>
                            </div>
                            <div style="color: #888; font-size: 14px; margin-bottom: 8px;">${rec.reason}</div>
                            <button onclick="viewRecommendation('${rec.title}')" style="background: #4f46e5; color: white; border: none; padding: 6px 12px; border-radius: 4px; font-size: 12px;">
                                View ${rec.type}
                            </button>
                        </div>
                    `).join('')}
                `;

                debugLog(`âœ“ Generated ${recommendations.length} recommendations`, 'success');
                document.getElementById('status-3').className = 'status success';
                document.getElementById('status-3').textContent = `âœ“ Generated ${recommendations.length} recommendations`;

            } catch (error) {
                debugLog(`âœ— Recommendation error: ${error.message}`, 'error');
                document.getElementById('status-3').className = 'status error';
                document.getElementById('status-3').textContent = 'âœ— Recommendation generation failed';
            }
        }

        // View recommendation action
        function viewRecommendation(title) {
            debugLog(`User clicked recommendation: ${title}`);
            alert(`Opening: ${title}\n\nIn a real implementation, this would navigate to the recommended content.`);
        }

        // Clear all data
        function clearData() {
            try {
                localStorage.removeItem('debug_keywords');
                updateCollectedList();
                debugLog('âœ“ Cleared all data', 'success');

                // Reset buttons
                document.querySelectorAll('.collect-btn').forEach(btn => {
                    btn.textContent = 'Collect';
                    btn.disabled = false;
                    btn.style.background = '#10b981';
                });

                // Clear recommendations
                document.getElementById('recommendations-area').innerHTML = `
                    <button onclick="generateRecommendations()" style="background: #4f46e5; color: white; border: none; padding: 8px 16px; border-radius: 4px;">
                        Generate Recommendations
                    </button>
                `;

            } catch (error) {
                debugLog(`âœ— Error clearing data: ${error.message}`, 'error');
            }
        }

        // Clear console
        function clearConsole() {
            document.getElementById('console-logs').innerHTML = '<div>ðŸŸ¢ Debug console cleared...</div>';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('ðŸš€ Debug page loaded');
            debugLog('Testing localStorage access...');

            try {
                localStorage.setItem('test', 'value');
                localStorage.removeItem('test');
                debugLog('âœ“ localStorage is available', 'success');
                document.getElementById('status-1').className = 'status success';
                document.getElementById('status-1').textContent = 'âœ“ localStorage available';
            } catch (error) {
                debugLog('âœ— localStorage not available: ' + error.message, 'error');
                document.getElementById('status-1').className = 'status error';
                document.getElementById('status-1').textContent = 'âœ— localStorage error: ' + error.message;
            }

            updateCollectedList();
        });
    </script>
</body>
</html>